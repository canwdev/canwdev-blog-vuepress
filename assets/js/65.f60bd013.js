(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{687:function(s,n,e){"use strict";e.r(n);var a=e(30),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"nginx-安装与配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx-安装与配置"}},[s._v("#")]),s._v(" Nginx 安装与配置")]),s._v(" "),e("h2",{attrs:{id:"ubuntu-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-安装"}},[s._v("#")]),s._v(" Ubuntu 安装")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"windows-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#windows-安装"}},[s._v("#")]),s._v(" Windows 安装")]),s._v(" "),e("p",[s._v("下载二进制文件 "),e("a",{attrs:{href:"http://nginx.org/en/docs/windows.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx for Windows"),e("OutboundLink")],1),s._v(" 并解压")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd c:\\\nunzip nginx-1.17.9.zip\ncd nginx-1.17.9\n# 后台运行\nstart nginx\n\nnginx -s stop \t# fast shutdown\nnginx -s quit \t# graceful shutdown\nnginx -s reload \t# changing configuration, starting new worker processes with a new configuration, graceful shutdown of old worker processes\nnginx -s reopen \t# re-opening log files\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("p",[s._v("修改 "),e("code",[s._v("conf/nginx.conf")]),s._v("，在 "),e("code",[s._v("http {}")]),s._v(" 中进行配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server {\n  listen 3082;\n  server_name localhost ;\n\n  location / {\n    # Windows 中必须使用正斜杠“/”，不能用反斜杠“\\”\n    root C:/vuepress/dist;\n    index index.html index.htm;\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h2",{attrs:{id:"一般情况-nginx-的配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一般情况-nginx-的配置"}},[s._v("#")]),s._v(" 一般情况 nginx 的配置")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑配置文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/nginx/sites-enabled/default\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置")]),s._v("\nnginx -s reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"托管静态文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#托管静态文件"}},[s._v("#")]),s._v(" 托管静态文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server {\n  listen 8080;\n  server_name localhost;\n\n  location / {\n    autoindex on;\n    root /usr/myservice/app8080/;\n    index index.html;\n  }\n}\n\nserver {\n  listen 8099;\n  server_name localhost;\n\n  location / {\n    root /usr/www/node-blog-management-ui/;\n    index index.html;\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("h3",{attrs:{id:"开启目录浏览-autoindex"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启目录浏览-autoindex"}},[s._v("#")]),s._v(" 开启目录浏览（autoindex）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server {\n    listen 3000;\n    server_name localhost;\n    location / {\n        autoindex on;             # 开启目录浏览\n        autoindex_exact_size off; # 默认为on，显示出文件的确切大小，单位是bytes。改为on后，显示的文件时间为文件的服务器时间。\n        autoindex_localtime on;   # 默认为off，显示的文件时间为GMT时间。改为on后，显示的文件时间为文件的服务器时间。\n        charset utf-8,gbk;        # 解决中文乱码问题\n\n        root /usr/www/vuepress/docs/.vuepress/dist;\n        index index.html;\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"使用-ssl-https"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-ssl-https"}},[s._v("#")]),s._v(" 使用 SSL(HTTPS)")]),s._v(" "),e("p",[s._v("一般情况下使用 443 端口作为 https 默认端口：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server {\n\tlisten                  80 default_server;\n\tlisten                  [::]:80 default_server;\n\n\tlisten                  *:443 ssl;\n\tssl_certificate         /home/ubuntu/server/cert/rootCA.pem;\n\tssl_certificate_key     /home/ubuntu/server/cert/rootCA.key;\n\n\tlocation / {\n        autoindex on;\n        root /usr/myservice/app8080/;\n        index index.html;\n\t}\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("由于服务器无备案，只能在非 80/443 端口设置SSL：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("server {\n  listen 81 ssl;\n  listen 8080;\n  server_name example.com;\n\n  # HTTP强制跳转HTTPS\n  error_page 497  https://$host:$server_port$request_uri;\n\n  ssl_certificate /usr/www/ssl/certificate.crt;\n  ssl_certificate_key /usr/www/ssl/private.key;\n\n  location / {\n    autoindex on;\n    root /usr/myservice/app8080/;\n    index index.html;\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"代理应用端口-如node-js、jenkins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代理应用端口-如node-js、jenkins"}},[s._v("#")]),s._v(" 代理应用端口（如Node.js、Jenkins）")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# jenkins\nserver {\n  listen 8098 ssl;\n  server_name example.com;\n\n  error_page 497  https://$host:$server_port$request_uri;\n  ssl_certificate /usr/www/ssl/certificate.crt;\n  ssl_certificate_key /usr/www/ssl/private.key;\n\n  location / {\n    proxy_set_header        Host $host:$server_port;\n    proxy_set_header        X-Real-IP $remote_addr;\n    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header        X-Forwarded-Proto $scheme;\n    proxy_pass http://localhost:3001;\n  }\n}\n\n# node-blog-server\nserver {\n  listen 9002 ssl;\n  server_name example.com;\n\n  ssl_certificate /usr/www/ssl/certificate.crt;\n  ssl_certificate_key /usr/www/ssl/private.key;\n\n  location / {\n  proxy_set_header        Host $host:$server_port;\n    proxy_set_header        X-Real-IP $remote_addr;\n    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header        X-Forwarded-Proto $scheme;\n    # 默认请求body只有2M，调大可避免上传大文件时的报错！\n    client_max_body_size 200M;\n    proxy_pass http://localhost:3102;\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("h3",{attrs:{id:"生成自签证书-pem-key-crt"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#生成自签证书-pem-key-crt"}},[s._v("#")]),s._v(" 生成自签证书（.pem/.key/.crt）")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("openssl genrsa -des3 -out rootCA.key "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nopenssl req -x509 -new -nodes -key rootCA.key -sha256 -days "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" -out rootCA.pem\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转换成 crt 格式")]),s._v("\nopenssl x509 -outform der -in rootCA.pem -out rootCA.crt\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("openssl req -newkey rsa:4096 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            -x509 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            -sha256 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            -days "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            -nodes "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            -out example.crt "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n            -keyout example.key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("注意：因为是自签名的证书，如果没有导入证书到系统信任列表里会遇到警告，可以直接忽略。")]),s._v(" "),e("p",[s._v("参考：")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://juejin.im/post/5a6db896518825732d7fd8e0",target:"_blank",rel:"noopener noreferrer"}},[s._v("【译】如何在5分钟内让HTTPS在您的本地开发环境中工作"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/Fishdrowned/ssl",target:"_blank",rel:"noopener noreferrer"}},[s._v("自签泛域名证书"),e("OutboundLink")],1)])]),s._v(" "),e("h3",{attrs:{id:"开启-cors-on-nginx-跨域支持"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启-cors-on-nginx-跨域支持"}},[s._v("#")]),s._v(" 开启 "),e("a",{attrs:{href:"https://enable-cors.org/server_nginx.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("CORS on Nginx"),e("OutboundLink")],1),s._v(" 跨域支持")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#\n# Wide-open CORS config for nginx\n#\nlocation / {\n     if ($request_method = 'OPTIONS') {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n        #\n        # Custom headers and headers various browsers *should* be OK with but aren't\n        #\n        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';\n        #\n        # Tell client that this pre-flight info is valid for 20 days\n        #\n        add_header 'Access-Control-Max-Age' 1728000;\n        add_header 'Content-Type' 'text/plain; charset=utf-8';\n        add_header 'Content-Length' 0;\n        return 204;\n     }\n     if ($request_method = 'POST') {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';\n        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';\n     }\n     if ($request_method = 'GET') {\n        add_header 'Access-Control-Allow-Origin' '*';\n        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';\n        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';\n        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';\n     }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])]),e("h3",{attrs:{id:"nginx-反向代理-mysql-的配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx-反向代理-mysql-的配置"}},[s._v("#")]),s._v(" Nginx 反向代理 MySQL 的配置")]),s._v(" "),e("blockquote",[e("p",[s._v("这对调试限制访问 IP 的生产服务器 MySQL Server 很有用")])]),s._v(" "),e("p",[s._v("首先，确保安装了 "),e("code",[s._v("nginx")]),s._v(" 和 "),e("code",[s._v("nginx-mod-stream")]),s._v("，一般在 Ubunut 上安装 nginx 时就会自带这个组件。使用 "),e("code",[s._v("nginx -V")]),s._v(" 查看。")]),s._v(" "),e("p",[s._v("编辑配置文件 "),e("code",[s._v("/etc/nginx/nginx.conf")]),s._v(" 与 http 节点同级：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("stream {\n    upstream mysql {\n        hash $remote_addr consistent;\n        server 192.168.99.2:3306 max_fails=3 fail_timeout=30s;\n    }\n    server {\n        listen 3307;\n        proxy_connect_timeout 30s;\n        proxy_timeout 600s;\n        proxy_pass mysql;\n    }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("保存，并使用 "),e("code",[s._v("nginx -t")]),s._v(" 测试配置的正确性，如果测试无误，使用 "),e("code",[s._v("nginx -s reload")]),s._v(" 使配置生效。")]),s._v(" "),e("p",[s._v("成功配置后，就可以使用 MySQL 客户端访问当前服务器的 3307 端口连接 "),e("code",[s._v("192.168.99.2:3306")]),s._v(" 的 MySQL 服务器了。")])])}),[],!1,null,null,null);n.default=t.exports}}]);