(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{606:function(s,t,a){"use strict";a.r(t);var n=a(57),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ssh-笔记"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-笔记"}},[s._v("#")]),s._v(" ssh 笔记")]),s._v(" "),a("h2",{attrs:{id:"linux-服务端安装-ssh-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-服务端安装-ssh-服务"}},[s._v("#")]),s._v(" Linux 服务端安装 ssh 服务")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装ssh服务器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start sshd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让服务开机自动启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" sshd\n")])])]),a("h2",{attrs:{id:"客户端连接-ssh-服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端连接-ssh-服务器"}},[s._v("#")]),s._v(" 客户端连接 ssh 服务器")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一般连接")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" example.com\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定用户名为 user")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" user@example.com\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定端口号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" user@example.com -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8022")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定私钥文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" -i ~/.ssh/id_rsa100 user@example.com\n")])])]),a("h2",{attrs:{id:"使用非对称密钥连接-ssh-服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用非对称密钥连接-ssh-服务器"}},[s._v("#")]),s._v(" 使用非对称密钥连接 ssh 服务器")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("ssh-keygen")]),s._v(" 命令，会在客户端 "),a("code",[s._v("~/.ssh/")]),s._v(" 目录下一对秘钥，带 "),a("code",[s._v(".pub")]),s._v(" 后缀的是公钥，同名不带 "),a("code",[s._v(".pub")]),s._v(" 的是私钥。")]),s._v(" "),a("p",[s._v("查看本机ssh公钥，并修改私钥权限：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cat .ssh/id_rsa.pub\n# 修改权限为 rw-------\nchmod 0600 .ssh/id_rsa\n")])])]),a("p",[s._v("在服务端用户的家目录下创建一个文件，并粘贴客户端的公钥")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" ~/.ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 粘贴客户端的 ~/.ssh/id_rsa.pub 内容")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ~/.ssh/authorized_keys\n")])])]),a("p",[s._v("或者用"),a("a",{attrs:{href:"https://serverfault.com/a/241593",target:"_blank",rel:"noopener noreferrer"}},[s._v("这种"),a("OutboundLink")],1),s._v("更快捷的添加公钥方式")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在客户端操作")]),s._v("\nssh-keygen -t rsa -b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n\nssh-copy-id user@example.com\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id -i ~/.ssh/id_rsa.pub user@example.com")]),s._v("\n")])])]),a("p",[s._v("用客户端测试连接。")]),s._v(" "),a("p",[s._v("如果连接成功，最好关闭服务端 ssh 的密码验证，只能使用客户端公钥验证登录（更安全）")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ssh/sshd_config\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PasswordAuthentication，默认值yes改为no")]),s._v("\nPasswordAuthentication no\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改了配置需要重启 ssh 服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart sshd\n")])])]),a("h2",{attrs:{id:"ssh-经常一段时间就断掉解决办法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-经常一段时间就断掉解决办法"}},[s._v("#")]),s._v(" SSH 经常一段时间就断掉解决办法")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo vim /etc/ssh/sshd_config\n\n# 找到下面两行\n# 客户端每隔多少秒向服务发送一个心跳数据\n# ClientAliveInterval 0\n# 客户端多少秒没有相应，服务器自动断掉连接\n# ClientAliveCountMax 3\n\n# 去掉注释，改成\nClientAliveInterval 30\nClientAliveCountMax 86400\n\n# 重启 sshd 服务\nsudo systemctl restart sshd\n")])])]),a("h2",{attrs:{id:"ssh-config-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-config-配置文件"}},[s._v("#")]),s._v(" ssh config 配置文件")]),s._v(" "),a("p",[s._v("通过创建 "),a("code",[s._v("~/.ssh/config")]),s._v(" 配置文件，可以方便地在终端使用一行命令连接 ssh 服务器。内容按如下格式编写：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Host vmware\n      HostName 192.168.50.130\n      Port 22\n      User ubuntu\n\nHost demo\n      HostName example.com\n      Port 8022\n      User admin\n\t  IdentityFile ~/.ssh/test1/id_rsa\n")])])]),a("p",[s._v("保存文件后，在终端输入 "),a("code",[s._v("ssh demo")]),s._v(" 即可直接连接，无需输入密码（公钥认证）。")])])}),[],!1,null,null,null);t.default=e.exports}}]);