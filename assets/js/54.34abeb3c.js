(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{697:function(s,t,n){"use strict";n.r(t);var e=n(35),a=Object(e.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"在-linux-中阻止特定程序联网"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在-linux-中阻止特定程序联网"}},[s._v("#")]),s._v(" 在 Linux 中阻止特定程序联网")]),s._v(" "),n("p",[s._v("参考："),n("a",{attrs:{href:"https://serverfault.com/a/550278",target:"_blank",rel:"noopener noreferrer"}},[s._v("How to block internet access to certain programs on Linux"),n("OutboundLink")],1),s._v("，使用了 "),n("code",[s._v("用户组")]),s._v(" 和 "),n("code",[s._v("iptables")]),s._v(" 的原理。")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("创建并将所需的用户添加到"),n("strong",[s._v("用户组")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("创建用户组："),n("code",[s._v("groupadd no-internet")])])]),s._v(" "),n("li",[n("p",[s._v("验证是否创建成功："),n("code",[s._v("grep no-internet /etc/group")])])]),s._v(" "),n("li",[n("p",[s._v("创建用户："),n("code",[s._v("useradd -g no-internet username")])]),s._v(" "),n("blockquote",[n("p",[s._v("注意：如果要修改已经存在的用户，则应运行："),n("code",[s._v("usermod -a -G no-internet userName")])]),s._v(" "),n("p",[s._v("检查用户是否在组内："),n("code",[s._v("sudo groups userName")])])])])])]),s._v(" "),n("li",[n("p",[s._v("在路径中创建一个脚本并将其可执行：")]),s._v(" "),n("ul",[n("li",[s._v("创建脚本："),n("code",[s._v("vim /home/username/.local/bin/no-internet")])]),s._v(" "),n("li",[s._v("脚本内容："),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\nsg no-internet "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[s._v("让其可执行："),n("code",[s._v("chmod 755 /home/username/.local/bin/no-internet")])])])]),s._v(" "),n("li",[n("p",[s._v("添加 "),n("code",[s._v("iptables")]),s._v(" 规则以禁止 "),n("code",[s._v("no-internet")]),s._v(" 组的网络活动：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("iptables -I OUTPUT "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -m owner --gid-owner no-internet -j DROP\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[s._v("注意：规则在重启后失效，另请参阅："),n("RouterLink",{attrs:{to:"/notes/linux.html#使用-iptables"}},[s._v("使用iptables")])],1)])]),s._v(" "),n("li",[n("p",[s._v("检查是否成功，例如运行一个 "),n("code",[s._v("bash")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("$ no-internet "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" bing.com\nping: bing.com: 未知的名称或服务\n^D\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" bing.com\nPING bing.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("204.79")]),s._v(".197.200"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from a-0001.a-msedge.net "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("204.79")]),s._v(".197.200"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("118")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.0")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from a-0001.a-msedge.net "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("204.79")]),s._v(".197.200"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("118")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.7")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])])]),s._v(" "),n("p",[s._v("如果你想例外允许程序访问"),n("strong",[s._v("本地网络")]),s._v("：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("iptables -A OUTPUT -m owner --gid-owner no-internet -d 192.168.1.0/24 -j ACCEPT")])]),s._v(" "),n("li",[n("code",[s._v("iptables -A OUTPUT -m owner --gid-owner no-internet -d 127.0.0.0/8 -j ACCEPT")])]),s._v(" "),n("li",[n("code",[s._v("iptables -A OUTPUT -m owner --gid-owner no-internet -j DROP")])])]),s._v(" "),n("blockquote",[n("p",[s._v("注意：如果在一个进程中打开另一个新进程，将维持规则。例如，如果你运行带有 "),n("code",[s._v("no-internet")]),s._v(" 规则的程序，并且该程序将打开浏览器窗口，则仍将应用这些规则。")])])])}),[],!1,null,null,null);t.default=a.exports}}]);