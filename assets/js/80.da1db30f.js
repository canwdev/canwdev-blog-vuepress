(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{650:function(e,t,n){"use strict";n.r(t);var s=n(57),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"使用-open-ssh-在-windows-上安装-sftp-ssh-服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-open-ssh-在-windows-上安装-sftp-ssh-服务器"}},[e._v("#")]),e._v(" 使用 Open SSH 在 Windows 上安装 sftp / ssh 服务器")]),e._v(" "),n("blockquote",[n("p",[e._v("原文链接：https://winscp.net/eng/docs/guide_windows_openssh_server")])]),e._v(" "),n("p",[e._v("Recently, "),n("a",{attrs:{href:"https://devblogs.microsoft.com/powershell/openssh-for-windows-update/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Microsoft has released"),n("OutboundLink")],1),e._v(" a port of "),n("a",{attrs:{href:"https://github.com/PowerShell/Win32-OpenSSH",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenSSH for Windows"),n("OutboundLink")],1),e._v(". You can use the package to set up an SFTP/SSH server on Windows.")]),e._v(" "),n("h2",{attrs:{id:"安装sftp-ssh服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装sftp-ssh服务器"}},[e._v("#")]),e._v(" 安装sftp / ssh服务器")]),e._v(" "),n("h3",{attrs:{id:"在windows-10版本1803和更高版本上"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在windows-10版本1803和更高版本上"}},[e._v("#")]),e._v(" 在Windows 10版本1803和更高版本上")]),e._v(" "),n("ul",[n("li",[e._v("In "),n("em",[e._v("Settings")]),e._v(" app, go to "),n("em",[e._v("Apps > Apps & features > Manage optional features")]),e._v(".")]),e._v(" "),n("li",[e._v("Locate "),n("em",[e._v("“OpenSSH server”")]),e._v(" feature, expand it, and select "),n("em",[e._v("Install")]),e._v(".")])]),e._v(" "),n("p",[e._v("Binaries are installed to "),n("code",[e._v("%WINDIR%\\System32\\OpenSSH")]),e._v(". Configuration file ("),n("code",[e._v("sshd_config")]),e._v(") and host keys are installed to "),n("code",[e._v("%ProgramData%\\ssh")]),e._v(" (only after the server is started for the first time).")]),e._v(" "),n("p",[e._v("如果要安装比Windows 10内置的open ssh更新的版本，则可能仍要使用以下手动安装。")]),e._v(" "),n("h3",{attrs:{id:"在windows的早期版本上"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在windows的早期版本上"}},[e._v("#")]),e._v(" 在Windows的早期版本上")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("Download the latest "),n("a",{attrs:{href:"https://github.com/PowerShell/Win32-OpenSSH/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenSSH for Windows binaries"),n("OutboundLink")],1),e._v(" (package "),n("code",[e._v("OpenSSH-Win64.zip")]),e._v(" or "),n("code",[e._v("OpenSSH-Win32.zip")]),e._v(")")])]),e._v(" "),n("li",[n("p",[e._v("As the Administrator, extract the package to "),n("code",[e._v("C:\\Program Files\\OpenSSH")])])]),e._v(" "),n("li",[n("p",[e._v("As the Administrator, install "),n("code",[e._v("sshd")]),e._v(" and "),n("code",[e._v("ssh-agent")]),e._v(" services:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("powershell.exe -ExecutionPolicy Bypass -File install-sshd.ps1\n")])])])])]),e._v(" "),n("h2",{attrs:{id:"配置ssh服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置ssh服务器"}},[e._v("#")]),e._v(" 配置SSH服务器")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("Allow incoming connections to SSH server in Windows Firewall:")]),e._v(" "),n("ul",[n("li",[n("p",[e._v("Either run the following PowerShell command (Windows 8 and 2012 or newer only),   as the Administrator:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("New-NetFirewallRule -Name sshd -DisplayName 'OpenSSH SSH Server' -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 22\n")])])])]),e._v(" "),n("li",[n("p",[e._v("or go to "),n("em",[e._v("Control Panel > System and Security > Windows Firewall")]),n("a",{attrs:{href:"https://winscp.net/eng/docs/guide_windows_openssh_server#fn1",target:"_blank",rel:"noopener noreferrer"}},[e._v("1"),n("OutboundLink")],1),e._v(" "),n("em",[e._v("> Advanced Settings > Inbound Rules")]),e._v(" and add a new rule for port 22.")])])])]),e._v(" "),n("li",[n("p",[e._v("Start the service and/or configure automatic start:")]),e._v(" "),n("ul",[n("li",[e._v("Go to "),n("em",[e._v("Control Panel > System and Security > Administrative Tools")]),e._v(" and open "),n("em",[e._v("Services")]),e._v(". Locate "),n("em",[e._v("OpenSSH SSH Server")]),e._v(" service.")]),e._v(" "),n("li",[e._v("If you want the server to start automatically when your machine is started: Go to "),n("em",[e._v("Action > Properties")]),e._v(". In the Properties dialog, change "),n("em",[e._v("Startup type")]),e._v(" to "),n("em",[e._v("Automatic")]),e._v(" and confirm.")]),e._v(" "),n("li",[e._v("Start the "),n("em",[e._v("OpenSSH SSH Server")]),e._v(" service by clicking the "),n("em",[e._v("Start the service")]),e._v(".")])])])]),e._v(" "),n("p",[n("em",[e._v("These instructions are partially based on "),n("a",{attrs:{href:"https://github.com/PowerShell/Win32-OpenSSH/wiki/Install-Win32-OpenSSH",target:"_blank",rel:"noopener noreferrer"}},[e._v("the official deployment instructions"),n("OutboundLink")],1),e._v(".")])]),e._v(" "),n("h2",{attrs:{id:"设置ssh公钥认证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置ssh公钥认证"}},[e._v("#")]),e._v(" 设置SSH公钥认证")]),e._v(" "),n("p",[e._v("Follow a generic guide for "),n("a",{attrs:{href:"https://winscp.net/eng/docs/guide_public_key",target:"_blank",rel:"noopener noreferrer"}},[e._v("Setting up SSH public key authentication"),n("OutboundLink")],1),e._v(" in *nix OpenSSH server, with the following difference:")]),e._v(" "),n("ul",[n("li",[e._v("Create the "),n("code",[e._v(".ssh")]),e._v(" folder (for the "),n("code",[e._v("authorized_keys")]),e._v(" file) in your Windows account profile folder (typically in "),n("code",[e._v("C:\\Users\\username\\.ssh")]),e._v(")."),n("a",{attrs:{href:"https://winscp.net/eng/docs/guide_windows_openssh_server#fn2",target:"_blank",rel:"noopener noreferrer"}},[e._v("2"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("For permissions to "),n("code",[e._v(".ssh")]),e._v(" folder and "),n("code",[e._v("authorized_keys")]),e._v(" file, what matters are Windows ACL permissions, not simple *nix permissions. Set the ACL so that only a  respective Windows account have a write access to the folder and the  file (what is the default access level, if you create the folder and the file, while logged in using the respective account).")])]),e._v(" "),n("h2",{attrs:{id:"连接到服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#连接到服务器"}},[e._v("#")]),e._v(" 连接到服务器")]),e._v(" "),n("h3",{attrs:{id:"寻找主机金钥"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#寻找主机金钥"}},[e._v("#")]),e._v(" 寻找主机金钥")]),e._v(" "),n("p",[e._v("Before the first connection, find out fingerprint of the server’s host key by using  "),n("code",[e._v("ssh-keygen.exe")]),e._v(" for each file.")]),e._v(" "),n("p",[e._v("In Windows command-prompt, use:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('for %f in (%ProgramData%\\ssh\\ssh_host_*_key) do @%WINDIR%\\System32\\OpenSSH\\ssh-keygen.exe -l -f "%f"\n')])])]),n("p",[n("em",[e._v("Replace "),n("code",[e._v("%WINDIR%\\System32")]),e._v(" with "),n("code",[e._v("%ProgramFiles%")]),e._v(", if appropriate.")])]),e._v(" "),n("p",[e._v("In PowerShell, use:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("Get-ChildItem $env:ProgramData\\ssh\\ssh_host_*_key | ForEach-Object { . $env:WINDIR\\System32\\OpenSSH\\ssh-keygen.exe -l -f $_ }\n")])])]),n("p",[n("em",[e._v("Replace "),n("code",[e._v("$env:WINDIR\\System32")]),e._v(" with "),n("code",[e._v("$env:ProgramFiles")]),e._v(", if appropriate.")])]),e._v(" "),n("p",[e._v("You will get an output like this:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('C:\\Windows\\System32\\OpenSSH>for %f in (%ProgramData%\\ssh\\ssh_host_*_key) do @%WINDIR%\\System32\\OpenSSH\\ssh-keygen.exe -l -f "%f"\n1024 SHA256:K1kYcE7GHAqHLNPBaGVLOYBQif04VLOQN9kDbiLW/eE martin@example (DSA)\n256 SHA256:7pFXY/Ad3itb6+fLlNwU3zc6X6o/ZmV3/mfyRnE46xg martin@example (ECDSA)\n256 SHA256:KFi18tCRGsQmxMPioKvg0flaFI9aI/ebXfIDIOgIVGU martin@example (ED25519)\n2048 SHA256:z6YYzqGiAb1FN55jOf/f4fqR1IJvpXlKxaZXRtP2mX8 martin@example (RSA)\n')])])]),n("h3",{attrs:{id:"连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#连接"}},[e._v("#")]),e._v(" 连接")]),e._v(" "),n("p",[e._v("Start WinSCP. "),n("a",{attrs:{href:"https://winscp.net/eng/docs/ui_login",target:"_blank",rel:"noopener noreferrer"}},[e._v("Login dialog"),n("OutboundLink")],1),e._v(" will appear. On the dialog:")]),e._v(" "),n("ul",[n("li",[e._v("Make sure "),n("em",[e._v("New site")]),e._v(" node is selected.")]),e._v(" "),n("li",[e._v("On "),n("em",[e._v("New site node")]),e._v(", make sure the "),n("em",[e._v("SFTP")]),e._v(" protocol is selected.")]),e._v(" "),n("li",[e._v("Enter your machine/server IP address (or a hostname) into the "),n("em",[e._v("Host name")]),e._v(" box.")]),e._v(" "),n("li",[e._v("Enter your Windows account name to the "),n("em",[e._v("User name")]),e._v(" box. It might have to be entered in the format "),n("code",[e._v("user@domain")]),e._v(", if running on a domain.")]),e._v(" "),n("li",[e._v("For a public key authentication:\n"),n("ul",[n("li",[e._v("Press the "),n("em",[e._v("Advanced")]),e._v(" button to open "),n("a",{attrs:{href:"https://winscp.net/eng/docs/ui_login_advanced",target:"_blank",rel:"noopener noreferrer"}},[e._v("Advanced site settings dialog"),n("OutboundLink")],1),e._v(" and go to "),n("em",[n("a",{attrs:{href:"https://winscp.net/eng/docs/ui_login_authentication",target:"_blank",rel:"noopener noreferrer"}},[e._v("SSH > Authentication page"),n("OutboundLink")],1)]),e._v(".")]),e._v(" "),n("li",[e._v("In "),n("em",[e._v("Private key file")]),e._v(" box select your private key file.")]),e._v(" "),n("li",[e._v("Submit Advanced site settings dialog with the "),n("em",[e._v("OK")]),e._v(" button.")])])]),e._v(" "),n("li",[e._v("For a password authentication:\n"),n("ul",[n("li",[e._v("Enter your Windows account password to the "),n("em",[e._v("Password")]),e._v(" box.")]),e._v(" "),n("li",[e._v("If you Windows account does not have a password, you  cannot authenticate with the password authentication (i.e. with an empty password), you need to use the public key authentication.")])])]),e._v(" "),n("li",[e._v("Save your site settings using the "),n("em",[e._v("Save")]),e._v(" button.")]),e._v(" "),n("li",[e._v("Login using "),n("em",[e._v("Login")]),e._v(" button.")]),e._v(" "),n("li",[n("a",{attrs:{href:"https://winscp.net/eng/docs/ssh_verifying_the_host_key",target:"_blank",rel:"noopener noreferrer"}},[e._v("Verify the host key"),n("OutboundLink")],1),e._v(" by comparing fingerprint with those collected before (see above).")])]),e._v(" "),n("p",[e._v("If you cannot authenticate to the server, and you are using Windows 10 "),n("em",[e._v("Developer mode")]),e._v(", make sure that your OpenSSH server does not conflict with an internal SSH server used by the "),n("em",[e._v("Developer mode")]),e._v(". You may need to turn off the "),n("em",[e._v("SSH Server Broker")]),e._v(" and "),n("em",[e._v("SSH Server Proxy")]),e._v(" Windows services. Or run your OpenSSH server on a different port than 22.")]),e._v(" "),n("h2",{attrs:{id:"进一步阅读"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#进一步阅读"}},[e._v("#")]),e._v(" 进一步阅读")]),e._v(" "),n("ul",[n("li",[e._v("Guide to "),n("a",{attrs:{href:"https://winscp.net/eng/docs/guide_windows_ftps_server",target:"_blank",rel:"noopener noreferrer"}},[e._v("Installing Secure FTP Server on Windows using IIS"),n("OutboundLink")],1),e._v(";")]),e._v(" "),n("li",[e._v("Guide to "),n("a",{attrs:{href:"https://winscp.net/eng/docs/guide_upload",target:"_blank",rel:"noopener noreferrer"}},[e._v("uploading files to SFTP server"),n("OutboundLink")],1),e._v(";")]),e._v(" "),n("li",[e._v("Guide to "),n("a",{attrs:{href:"https://winscp.net/eng/docs/guide_automation",target:"_blank",rel:"noopener noreferrer"}},[e._v("automating operations"),n("OutboundLink")],1),e._v(" (including upload).")])]),e._v(" "),n("hr"),e._v(" "),n("ol",[n("li",[n("em",[e._v("Windows Defender Firewall")]),e._v(" on Windows 10."),n("a",{attrs:{href:"https://winscp.net/eng/docs/guide_windows_openssh_server#fnt1",target:"_blank",rel:"noopener noreferrer"}},[e._v("Back"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("Windows File Explorer does not allow you to create a folder starting with a dot directly. As a workaround, use "),n("code",[e._v(".ssh.")]),e._v(", the trailing dot will allow you to bypass the restriction, but will not be included in the name.")])])])}),[],!1,null,null,null);t.default=r.exports}}]);