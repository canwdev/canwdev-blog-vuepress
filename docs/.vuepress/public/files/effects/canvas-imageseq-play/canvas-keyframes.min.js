!function(){"use strict";function t(t,i,s,o){if(!t||!s)throw new Error("el和imgs是必填参数");if("array"!==i&&"sprite"!==i)throw new Error('只支持"array"和"sprite"模式');this.el=t,this.mode=i,this.imgs=s,this.imgsLen=null,this.canvas=null,this.ctx=null,this.timer=null,this.state="stop",this.infinite=1e9,this.ispause=!1,this.plusNum=0,this.plusCount=0;var e={cover:this.count=0,fps:24,loop:"infinite",ratio:1};this.options=o||e,this.options.cover=o.cover||e.cover,this.options.fps=o.fps||e.fps,this.options.loop=o.loop||e.loop,this.options.ratio=o.ratio||e.ratio,this.recordFrom=0,this.recordTo=null,this.recordInf=this.options.loop,function(t){if(function(t){var i=document.createElement("canvas");i.width=2*t.options.width||t.el.clientWidth,i.height=2*t.options.height||t.el.clientHeight,i.style.display="block",i.style.width="100%",i.style.height="100%",t.ctx=i.getContext("2d"),t.el.appendChild(i),t.canvas=i}(t),"array"===t.mode)t.imgsLen=t.imgs.length;else if("sprite"===t.mode){t.wt=t.imgs.width/t.options._iw,t.ht=t.imgs.height/t.options._ih;for(var i=[],s=0;s<t.ht;s++)for(var o=0;o<t.wt;o++)i.push({x:t.options._iw*o,y:t.options._ih*s});t.spriteArray=i,t.imgsLen=t.options.framesCount?t.options.framesCount:Math.round(2*t.imgs.width/(t.canvas.width*t.options.ratio))}t.recordTo=t.imgsLen-1,function(t){n(t,t.options.cover)}(t)}(this)}function n(t,i){if(t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),"array"===t.mode)0!==t.imgs[i].width&&t.ctx.drawImage(t.imgs[i],0,0,t.canvas.width,t.canvas.height);else{if("sprite"!==t.mode)throw new Error("没有匹配的模式");if(t.options.framesCount)t.ctx.drawImage(t.imgs,t.spriteArray[i].x,t.spriteArray[i].y,t.options._iw,t.options._iw,0,0,t.canvas.width,t.canvas.height);else{var s=t.imgs.width/t.imgsLen;t.ctx.drawImage(t.imgs,s*i,0,s,t.imgs.height,0,0,t.canvas.width,t.canvas.height)}}}t.prototype={constructor:t,goto:function(t){n(this,t),this.count=t},next:function(){var t=(this.count+1+this.imgsLen-1)%(this.imgsLen-1);this.goto(t)},prev:function(){var t=(this.count-1+this.imgsLen-1)%(this.imgsLen-1);this.goto(t)},fromTo:function(t,i,s,o){var e=this;clearInterval(this.timer);function n(){if(!e.ispause)return e.plusNum<=e.plusCount?(clearInterval(e.timer),e.timer=null,e.plusNum=0,e.plusCount=0,e.state="stop",void(o&&o())):(i<r&&(r=t),e.goto(r),r++,void e.plusCount++)}var r=t;this.plusCount=0,this.state="play",s=s&&"infinite"!==s?s:this.infinite,this.plusNum=(i-t+1)*s,this.ispause=!1,this.recordFrom=t,this.recordTo=i,this.recordInf=s,n(),this.timer=setInterval(n,1e3/this.options.fps)},toFrom:function(t,i,s,o){var e=this;clearInterval(this.timer);function n(){if(!e.ispause)return e.plusNum<=e.plusCount?(clearInterval(e.timer),e.timer=null,e.plusNum=0,e.plusCount=0,e.state="stop",void(o&&o())):(r<i&&(r=t),e.goto(r),r--,void e.plusCount++)}var r=t;this.plusCount=0,this.state="play",s=s&&"infinite"!==s?s:this.infinite,this.plusNum=(t-i+1)*s,this.ispause=!1,this.recordFrom=i,this.recordTo=t,this.recordInf=s,n(),this.timer=setInterval(n,1e3/this.options.fps)},repeatplay:function(t,i,s,o){var e=this,n=0;s=s&&"infinite"!==s?s:this.infinite;function r(){++n===s?o&&o():e.fromTo(t,i,2,o)}this.fromTo(t,i,1,function(){e.toFrom(i,t,1,r)})},from:function(t,i,s){var o=this.imgsLen-1;this.fromTo(t,o,i,s)},to:function(t,i,s){this.fromTo(0,t,i,s)},pause:function(){this.ispause=!0,this.state="stop"},stop:function(){clearInterval(this.timer),this.state="stop",this.plusNum=0,this.plusCount=0,this.ispause=!1,this.recordFrom=0,this.recordTo=this.imgsLen-1,this.recordInf=this.options.loop,n(this,this.options.cover)},play:function(t){"play"!==this.state&&(this.ispause?this.ispause=!1:this.fromTo(this.recordFrom,this.recordTo,this.recordInf,t))},destroy:function(){for(var t in clearInterval(this.timer),this.timer=null,this.ctx=null,this.canvas.remove(),this.canvas=null,this)delete this[t]}},"function"==typeof define&&define.amd&&define([],function(){return t}),"undefined"!=typeof exports&&(exports.CanvasKeyFrames=t),"undefined"!=typeof window&&(window.CanvasKeyFrames=t)}();